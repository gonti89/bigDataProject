FROM py_spark_base
COPY processing.py .
ENV KAFKA_TOPIC=$KAFKA_TOPIC \
    KAFKA_SERVER=$KAFKA_SERVER \
    IN_KAFKA_TOPIC=$IN_KAFKA_TOPIC \
    OUT_KAFKA_TOPIC_DECO=$OUT_KAFKA_TOPIC_DECO \
    OUT_KAFKA_TOPIC_SESSION=$OUT_KAFKA_TOPIC_SESSION \
    USER_SESSION_MAX_GAP_MINUTES=$USER_SESSION_MAX_GAP_MINUTES

RUN pip --no-cache-dir install user_agents
CMD python ./processing.py ${KAFKA_SERVER} \
    ${KAFKA_PORT} \
    ${IN_KAFKA_TOPIC} \
    ${OUT_KAFKA_TOPIC_DECO} \
    ${OUT_KAFKA_TOPIC_SESSION} \
    ${USER_SESSION_MAX_GAP_MINUTES}
